# 智能家居场景多设备联动的实现方法

本文基于工作流的方式实现IOT系统中多设备联动的问题。以比较典型的物联网场景智能家居为例子。  

## 需求

在智能家居系统中往往会有多设备联动的需求，比如回家自动开灯，天黑自动开灯，天热自动开空调等。  

换一个角度解释即用户可以预设一些设备的状态并设置进入这种状态的条件，达到条件后自动将设备操作到对应的状态。比如主人回家后屋的所有灯自动打开的场景，用户预设的屋里所有的灯打开这个状态，进入所有灯都打开这个状态的条件是主人回家。可以通过门锁打开、主人自己在APP云端点击等触发这个条件。

## 分析

这种功能实际上生活上已经有很多，比如声控开关、空调的定时功能都是类似功能，只是这些都只是单个设备的能力，无法进行多设备联动进行更加复杂的操作。所以是进入万物互连时代后才有可能让多个设备进行联动。将设备的一些通用计算能力等交给设备管理平台即IOT系统进行统一管理和计算，让设备本身只负责做设备自己独有的功能。比如空调的定时功能，很多设备也有类似定时的需求，所以像定时触发这个功能可以由IOT系统实现，空调值负责调节温度。  

## 设计

将该功能分为几个模块，属性管理模块、表达式模块、事件管理模块、场景管理模块、工作流模块等。属性模块是对设备属性的增删改查操作，表达式模块是解析执行表达式的模块，事件模块是触发执行的事件模块包括时间变化事件（定时服务）、属性变化事件等。场景模块是预设属性状态的集合，工作流模块是联动的详情。

## 实现


